<!DOCTYPE html>
<html lang="es">
<head>

<link rel="icon" href="favicon.png" sizes="512x512">
<link rel="apple-touch-icon" href="favicon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Registro Detenidos">
	
<link rel="manifest" href="manifest.json">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8"/>
<title>Registro de Detenidos</title>
<script src="./js/estilo_registro.js"></script>
</head>
<body>
<h1>Registro Detenidos</h1>
<form autocomplete="off" id="registroForm">
<h2> </h2>
<div class="grid-rows">
<div class="field-card" style="color: lightblue;">
<label>Tipo Documento</label>
<select id="tipoDocumento" name="TIPO DOCUMENTO_OPCION">
<option selected value="INDOCUMENTADO">Indocumentado</option>
<option value="INDOCUMENTADA">Indocumentada</option>
<option value="DNI">DNI</option>
<option value="NIE">NIE</option>
<option value="Pasaporte">Pasaporte</option>
<option value="Carta Nacional de Identidad">Carta Nacional de Identidad</option>
<option value="OTRO">OTRO</option>
</select>
<input id="tipoDocumentoOtro" name="TIPO DOCUMENTO" placeholder="Especificar otro" style="display:none;" type="text"/>
</div>
<div class="field-card" style="color: lightblue;">
<label>N¬∫ Documento</label>
<input id="numeroDocumento" name="N¬∫DOCUMENTO" type="text"
       oninput="this.value=this.value.toUpperCase()">
</div>
<div class="field-card" style="color: lightblue;">
<label>Sexo</label>
<select id="sexoOpcion" name="SEXO_OPCION" required="">
<option selected="" value="">-- Seleccionar --</option>
<option value="MASCULINO">MASCULINO</option>
<option value="FEMENINO">FEMENINO</option>
</select>
</div>
<div class="field-card" style="color: lightblue;">
<label>Nacionalidad</label>
<input id="nacionalidadInput" list="listaNacionalidad" name="NACIONALIDAD" required="" type="text"/>
<datalist id="listaNacionalidad"></datalist>
</div>
<div class="field-card" style="color: lightblue;"><label>Nombre</label><input id="Nombre" name="Nombre" type="text" oninput="this.value = this.value.toLowerCase().replace(/\b\w+/g, w => w.charAt(0).toUpperCase() + w.slice(1));"/></div>
<div class="field-card" style="color: lightblue;"><label>Apellidos</label><input id="APELLIDOS" name="APELLIDOS" type="text"oninput="this.value=this.value.toUpperCase()"></div>
<div class="field-card" style="color: lightblue;">
<label>Nombre de los Padres</label>
<select id="nombrePadresOpcion" name="NOMBRE_PADRES_OPCION">
<option selected="" value="NO APORTA">NO APORTA</option>
<option value="OTRO">OTRO</option>
</select>
<input id="nombrePadresTexto" name="NOMBRE_PADRES" placeholder="Especificar" style="display:none;" type="text"
oninput="this.value = this.value.toLowerCase()
  .replace(/\b\w+/g, function(w){ return w.charAt(0).toUpperCase() + w.slice(1); })
  .replace(/\bY\b/g, 'y');"/>
</div>
<div class="field-card" style="color: lightblue;"><label>Fecha de nacimiento</label><input name="FECHA DE NACIMIENTO" placeholder="DD/MM/AAAA" required="" type="date"/></div>
<div class="field-card" style="color: lightblue;">
<label>Lugar de nacimiento</label>
<input id="paisNacimiento" list="listaPaisNacimiento" required="" style="width:100%;"/>
<datalist id="listaPaisNacimiento"></datalist>
<select id="provNacimiento" style="display:none;">
<option value="">-- Provincia --</option>
</select>
<input id="munNacimiento" list="listaMunNacimiento" placeholder="Municipio" style="display:none; width:100%;"/>
<datalist id="listaMunNacimiento"></datalist>
<input id="lugarNacimientoHidden" name="LUGAR DE NACIMIENTO" type="hidden">
</input></div>
<div class="field-card" style="color: lightblue;">
<label>Domicilio</label>
<select id="domicilioOpcion" name="DOMICILIO_OPCION">
<option value="">-- Selecciona --</option>
<option value="NO APORTA">NO APORTA</option>
<option value="APORTA">APORTA</option>
</select>
<div id="domicilioBloque" style="display:none; width:100%;">
<select id="provDomicilio" style="margin-top:6px; width:100%;">
<option value="">-- Provincia --</option>
</select>
<input id="munDomicilio" list="listaMunDomicilio" placeholder="Municipio" style="margin-top:6px; width:100%;"/>
<datalist id="listaMunDomicilio"></datalist>
<input id="direccionDomicilio" maxlength="120" placeholder="Direcci√≥n (calle, n¬∫, piso...)" style="display:none; width:100%; margin-bottom:8px;" type="text">
</input></div>
<input id="domicilioTextoHidden" name="DOMICILIO" type="hidden"/>
<script src="./js/paises.js"></script>
<script src="./js/provincias_es.js"></script>
<script src="./js/municipios.js"></script>
<script src="./js/calles.js"></script>
</div>
<script>
      
      let PROVINCIAS_ES = [];
      (async function cargarProvinciasES(){
        try{
          
          if (Array.isArray(window.PROVINCIAS_ES) && window.PROVINCIAS_ES.length){
            PROVINCIAS_ES = window.PROVINCIAS_ES.slice();
          } else if (Array.isArray(window.PROVINCIAS_ES_GLOBAL) && window.PROVINCIAS_ES_GLOBAL.length){
            PROVINCIAS_ES = window.PROVINCIAS_ES_GLOBAL.slice();
          } else {
            throw new Error('No hay global de provincias (usa js/provincias_es.js)');
          }
        }catch(_e){
          
          PROVINCIAS_ES = [
            "A Coru√±a","√Ålava","Albacete","Alicante","Almer√≠a","Asturias","√Åvila","Badajoz","Illes Balears","Barcelona","Burgos","C√°ceres","C√°diz","Cantabria","Castell√≥n","Ciudad Real","C√≥rdoba","Cuenca","Girona","Granada","Guadalajara","Gipuzkoa","Huelva","Huesca","Ja√©n","La Rioja","Las Palmas","Le√≥n","Lleida","Lugo","Madrid","M√°laga","Murcia","Navarra","Ourense","Palencia","Pontevedra","Salamanca","Santa Cruz de Tenerife","Segovia","Sevilla","Soria","Tarragona","Teruel","Toledo","Valencia","Valladolid","Bizkaia","Zamora","Zaragoza","Ceuta","Melilla"
          ];
          console.warn('‚ö†Ô∏è Usando fallback de provincias al no encontrar globals.');
        }
        poblarProvincias('provNacimiento');
        poblarProvincias('provDomicilio');
      })();

      
      let MUNICIPIOS_ES = { type:null, data:null, ready:false };

      function __normUp(s){
        return String(s||'').trim().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
      }

      (async function cargarMunicipios(){
        try{
          
          
          let g = null;
          if (typeof window.MUNICIPIOS_ES   !== 'undefined') g = window.MUNICIPIOS_ES;
          else if (typeof window.MUNICIPIOS_MAP  !== 'undefined') g = window.MUNICIPIOS_MAP;
          else if (typeof window.MUNICIPIOS_FLAT !== 'undefined') g = window.MUNICIPIOS_FLAT;
          else if (typeof window.MUNICIPIOS      !== 'undefined') g = window.MUNICIPIOS;

          if (!g) throw new Error('No hay global de municipios (usa js/municipios.js)');

          if (Array.isArray(g)){
            
            MUNICIPIOS_ES = { type:'flat', data:new Set(g.map(__normUp)), ready:true };
          } else if (g && typeof g === 'object'){
            
            const map = {};
            for (const [k,v] of Object.entries(g)){
              map[__normUp(k)] = Array.isArray(v) ? v.slice() : [];
            }
            MUNICIPIOS_ES = { type:'map', data:map, ready:true };
          } else {
            throw new Error('Formato de municipios global inv√°lido');
          }
        }catch(e){
          console.error("No se pudo cargar municipios (globals):", e);
          MUNICIPIOS_ES = { type:'map', data:{}, ready:true };
        }
        
        try{
          const pN = document.getElementById('provNacimiento')?.value;
          if (pN) poblarMunicipios('munNacimiento', pN);
          const pD = document.getElementById('provDomicilio')?.value;
          if (pD) poblarMunicipios('munDomicilio', pD);
        }catch(_e){}
      })();

      function getMunicipios(prov){
        if (!MUNICIPIOS_ES.ready) return null;
        if (MUNICIPIOS_ES.type === 'flat'){
          return Array.from(MUNICIPIOS_ES.data).sort();
        }
        const key = __normUp(prov);
        return (MUNICIPIOS_ES.data[key] || []).slice();
      }

      
      (async function poblarPaisesDatalist(){
        const conf = [
          { inputId: 'paisNacimiento', listId: 'listaPaisNacimiento' },
          { inputId: 'nacionalidadInput', listId: 'listaNacionalidad' }
        ];
        const pairs = conf
          .map(c => ({ inp: document.getElementById(c.inputId), dl: document.getElementById(c.listId) }))
          .filter(o => o.inp && o.dl);
        if (!pairs.length) return;

        function fillList(datalist, values){
          datalist.innerHTML = values.map(v => `<option value="${String(v)}"></option>`).join('');
        }

        
        let values = [];
        const data = (typeof window.PAISES !== 'undefined') ? window.PAISES : (typeof window.paises !== 'undefined' ? window.paises : null);
        if (data){
          if (Array.isArray(data)){
            values = data.slice();
          } else if (data && typeof data === 'object'){
            const featured = Array.isArray(data.featured) ? data.featured.slice() : [];
            const grouped  = Array.isArray(data.groups) ? data.groups.flatMap(g => (Array.isArray(g.items) ? g.items : [])) : [];
            values = [...featured, ...grouped];
          }
        }

        
        if (!values.length){
          console.warn('‚ö†Ô∏è No hay window.PAISES definido en js/paises.js');
        }

        
        if (values.length){
          const idx = values.findIndex(x => String(x).toUpperCase() === 'ESPA√ëA');
          if (idx > 0){ const sp = values.splice(idx,1)[0]; values.unshift(sp); }
        }

        pairs.forEach(({dl}) => fillList(dl, values));
        pairs.forEach(({inp}) => { inp.setAttribute('autocomplete','off'); });
      })();

      
      function poblarProvincias(selectId){
        const sel = document.getElementById(selectId);
        if (!sel) return;
        let arr = Array.isArray(PROVINCIAS_ES) ? PROVINCIAS_ES.slice() : [];
        const idx = arr.findIndex(p => String(p).toUpperCase() === 'SANTA CRUZ DE TENERIFE');
        if (idx > -1){ const sc = arr.splice(idx,1)[0]; arr.unshift(sc); }
        const opts = ['<option value="">-- Provincia --</option>']
          .concat(arr.map(p => `<option value="${p}">${p}</option>`)).join('');
        sel.innerHTML = opts;
      }
      function poblarMunicipios(selectId, prov){
        const el = document.getElementById(selectId);
        if (!el) return;

        
        if (!MUNICIPIOS_ES.ready){
          if (el.tagName === 'SELECT'){
            el.innerHTML = '<option value="">Cargando municipios‚Ä¶</option>';
            el.disabled = true;
          }
          const t = setInterval(()=>{
            if (MUNICIPIOS_ES.ready){
              clearInterval(t);
              poblarMunicipios(selectId, prov);
            }
          }, 200);
          return;
        }

        const lista = getMunicipios(prov) || [];

        if (el.tagName === 'SELECT'){
          el.disabled = false;
          const opts = ['<option value="">-- Municipio --</option>']
            .concat(lista.map(m => `<option value="${m}">${m}</option>`))
            .join('');
          el.innerHTML = opts;
          return;
        }
        if (el.tagName === 'INPUT' && el.getAttribute('list')){
          const dl = document.getElementById(el.getAttribute('list'));
          if (!dl) return;
          dl.innerHTML = lista.map(m => `<option value="${m}"></option>`).join('');
          el.value = '';
          return;
        }
      }
      function isSpain(v){
        const t = String(v||'').trim().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase();
        return t === 'ESPA√ëA' || t === 'ESPANA' || t === 'ES';
      }

      
      const paisInp = document.getElementById('paisNacimiento');
      const provNac = document.getElementById('provNacimiento');
      const munNac  = document.getElementById('munNacimiento');
      const lugarNacHidden = document.getElementById('lugarNacimientoHidden');

      const domSel = document.getElementById('domicilioOpcion');
      const domBlk = document.getElementById('domicilioBloque');
      const provDom = document.getElementById('provDomicilio');
      const munDom  = document.getElementById('munDomicilio');
      const dirDom  = document.getElementById('direccionDomicilio');
      const domHidden = document.getElementById('domicilioTextoHidden');

      function recomputeLugarNacimiento(){
        const pais = (paisInp.value||'').trim();
        if (isSpain(pais)){
          const p = (provNac.value||'').trim();
          const m = (munNac.value||'').trim();
          lugarNacHidden.value = (m && p) ? `${m}, ${p}` : (p || m || 'ESPA√ëA');
        } else {
          lugarNacHidden.value = pais || '';
        }
      }

      function handlePaisNacimientoChange(){
        const esES = isSpain(paisInp.value);
        provNac.style.display = esES ? 'block' : 'none';
        munNac.style.display  = esES ? 'block' : 'none';
        provNac.required = esES;
        munNac.required  = esES;
        if (!esES){ provNac.value=''; munNac.value=''; provNac.required=false; munNac.required=false; }
        recomputeLugarNacimiento();
      }
      paisInp.addEventListener('change', handlePaisNacimientoChange, {passive:true});
      paisInp.addEventListener('input',  handlePaisNacimientoChange, {passive:true});
      provNac.addEventListener('change', ()=>{
        poblarMunicipios('munNacimiento', provNac.value);
        munNac.value='';
        recomputeLugarNacimiento();
      }, {passive:true});
      munNac.addEventListener('input', recomputeLugarNacimiento, {passive:true});
      munNac.addEventListener('change', recomputeLugarNacimiento, {passive:true});

      
      domSel.addEventListener('change', ()=>{
        const v = domSel.value;
        const aporta = (v === 'APORTA');

        if (aporta){
          
          domBlk.style.display = 'flex';
          domBlk.style.flexDirection = 'column';
          domBlk.style.gap = '8px';

          
          if (provDom) provDom.style.display = 'block';
          if (munDom)  munDom.style.display  = 'block';
          if (dirDom)  dirDom.style.display  = 'block';

          
          provDom.required = true;
          munDom.required  = true;
          dirDom.required  = true;
        } else {
          
          domBlk.style.display = (v ? 'none' : 'none');
          if (provDom){ provDom.value=''; provDom.required=false; }
          if (munDom){  munDom.value='';  munDom.required=false;  munDom.style.display='none'; }
          if (dirDom){  dirDom.value='';  dirDom.required=false;  dirDom.style.display='none'; }
        }

        
        domHidden.value = (v === 'NO APORTA') ? 'NO APORTA' : (aporta ? (dirDom.value||'') : '');
      }, {passive:true});
      provDom.addEventListener('change', ()=>{ poblarMunicipios('munDomicilio', provDom.value); munDom.value=''; }, {passive:true});
      dirDom.addEventListener('input', ()=>{ if (domSel.value === 'APORTA'){ domHidden.value = dirDom.value; } }, {passive:true});

      
      function abrirDomicilioYEnfocar(campo){
        if (domSel.value !== 'APORTA'){
          domSel.value = 'APORTA';
          domSel.dispatchEvent(new Event('change'));
        } else {
          domBlk.style.display = 'flex';
          domBlk.style.flexDirection = 'column';
          domBlk.style.gap = '8px';
          provDom.required = true; munDom.required = true; dirDom.required = true;
        }
        
if (campo === 'dir'  && dirDom)  { dirDom.style.display='block'; }
      }

      provDom.addEventListener('mousedown', ()=>abrirDomicilioYEnfocar('prov'), {passive:true});
      munDom.addEventListener('mousedown', ()=>abrirDomicilioYEnfocar('mun'),  {passive:true});
      provDom.addEventListener('change',   ()=>abrirDomicilioYEnfocar('mun'),  {passive:true});

      function _abrirDirSiHayMunSinFoco(){
        if ((munDom.value||'').trim().length){
          if (domSel.value !== 'APORTA'){
            domSel.value = 'APORTA';
            domSel.dispatchEvent(new Event('change'));
          } else {
            domBlk.style.display = 'flex';
            domBlk.style.flexDirection = 'column';
            domBlk.style.gap = '8px';
            provDom.required = true; munDom.required = true; dirDom.required = true;
          }
          dirDom.style.display = 'block';
        }
      }
      munDom.addEventListener('change', _abrirDirSiHayMunSinFoco, {passive:true});
      munDom.addEventListener('blur',   _abrirDirSiHayMunSinFoco, {passive:true});

      document.addEventListener('DOMContentLoaded', ()=>{
        const tieneMun  = (munDom.value||'').trim().length>0;
        const tieneProv = (provDom.value||'').trim().length>0;
        if (tieneMun || tieneProv) abrirDomicilioYEnfocar(tieneMun ? 'dir' : 'mun');
      }, {once:true});

      
      (function installExportWrapper(){
        function hook(){
          if (typeof window.exportarJSON !== 'function'){ return setTimeout(hook, 50); }
          const prev = window.exportarJSON;
          window.exportarJSON = async function(){
            const form = document.getElementById('registroForm');
            form.setAttribute('data-pais-nac', (paisInp.value||'').trim());
            form.setAttribute('data-prov-nac', (provNac.value||'').trim());
            form.setAttribute('data-mun-nac',  (munNac.value||'').trim());
            form.setAttribute('data-prov-dom', (provDom.value||'').trim());
            form.setAttribute('data-mun-dom',  (munDom.value||'').trim());
            const __save = window.saveBlobJson;
            window.saveBlobJson = async function(text, filename){
              try{
                const obj = JSON.parse(text);
                obj["NACIONALIDAD"] = (document.getElementById('nacionalidadInput')?.value ?? obj["NACIONALIDAD"]) || "";
                const P  = String(form.getAttribute('data-pais-nac')||'').toUpperCase();
                const Pr = String(form.getAttribute('data-prov-nac')||'').toUpperCase();
                const Mu = String(form.getAttribute('data-mun-nac')||'');
                const PD = String(form.getAttribute('data-prov-dom')||'').toUpperCase();
                const MD = String(form.getAttribute('data-mun-dom')||'');

                obj["pais-nacimiento"]      = P;
                obj["provincia-nacimiento"] = Pr;
                obj["municipio-nacimiento"] = Mu;

                obj["provincia-domicilio"]  = PD;
                obj["municipio-domicilio"]  = MD;

                const esES = (P === 'ESPA√ëA' || P === 'ESPANA' || P === 'ES' || P === 'SPAIN' || P === 'REINO DE ESPANA');
                if (P){
                  obj["Lugar de nacimiento"] = esES ? ((Mu && Pr) ? `${Mu}, ${Pr}` : (Pr || Mu || 'ESPA√ëA')) : P;
                }
                text = JSON.stringify(obj, null, 2);
              }catch(_e){}
              return __save.call(this, text, filename);
            };
            try{
              return await prev.apply(this, arguments);
            } finally {
              window.saveBlobJson = __save;
            }
          };
        }
        hook();
      })();
      </script>
<div class="field-card" style="color: lightblue;">
<label>Tel√©fono</label>
<select id="telefonoOpcion" name="TEL√âFONO_OPCION">
<option selected="" value="NO APORTA">NO APORTA</option>
<option value="OTRO">OTRO</option>
</select>
<input id="telefonoTexto" name="TEL√âFONO" placeholder="Especificar" style="display:none;" type="text" inputmode="numeric" oninput="this.value=this.value.replace(/[^0-9]/g,'')"/>
</div>
<div class="field-card" style="color: red;"><label>Fecha del registro</label><input id="fechaGeneracion" name="FECHA_GENERACION" type="text"/></div>
</div>
<h2> </h2>
<div class="grid-rows">
<div class="field-card" style="color: lightgreen;">
<label>Delito(s)</label>
<select id="delitoSelect">
<option value="">-- Seleccionar --</option>
<option value="HURTO">HURTO</option>
<option value="DA√ëOS">DA√ëOS</option>
<option value="ESTAFA">ESTAFA</option>
<option value="ROBO CON VIOLENCIA">ROBO CON VIOLENCIA</option>
<option value="ROBO CON FUERZA">ROBO CON FUERZA</option>
<option value="ROBO USO DE VEH√çCULO">ROBO USO DE VEH√çCULO</option>
<option value="HURTO USO DE VEH√çCULO">HURTO USO DE VEH√çCULO</option>
<option value="APROPIACI√ìN INDEBIDA">APROPIACI√ìN INDEBIDA</option>
<option value="LESIONES">LESIONES</option>
<option value="HOMICIDIO">HOMICIDIO</option>
<option value="AMENAZAS GRAVES">AMENAZAS GRAVES</option>
<option value="ACOSO">ACOSO</option>
<option value="MALOS TRATOS EN EL √ÅMBITO FAMILIAR">MALOS TRATOS EN EL √ÅMBITO FAMILIAR</option>
<option value="COACCIONES">COACCIONES</option>
<option value="ABUSO SEXUAL">ABUSO SEXUAL</option>
<option value="AGRESI√ìN SEXUAL">AGRESI√ìN SEXUAL</option>
<option value="VIOLACI√ìN">VIOLACI√ìN</option>
<option value="ATENTADO AGENTE AUTORIDAD">ATENTADO AGENTE AUTORIDAD</option>
<option value="RESISTENCIA / DESOBEDIENCIA">RESISTENCIA / DESOBEDIENCIA</option>
<option value="CONTRA LA SEGURIDAD VIAL">CONTRA LA SEGURIDAD VIAL</option>
<option value="CONTRA LA SALUD P√öBLICA">CONTRA LA SALUD P√öBLICA</option>
<option value="TR√ÅFICO DE DROGAS">TR√ÅFICO DE DROGAS</option>
<option value="FALSEDAD DOCUMENTAL">FALSEDAD DOCUMENTAL</option>
<option value="RECLAMACI√ìN JUDICIAL">RECLAMACI√ìN JUDICIAL</option>
<option value="QUEBRANTAMIENTO DE CONDENA">QUEBRANTAMIENTO DE CONDENA</option>
<option value="RI√ëA TUMULTUARIA">RI√ëA TUMULTUARIA</option>
<option value="DETENCI√ìN ILEGAL">DETENCI√ìN ILEGAL</option>
<option value="OMISI√ìN DEL DEBER DE SOCORRO">OMISI√ìN DEL DEBER DE SOCORRO</option>
<option value="ALLANAMIENTO DE MORADA">ALLANAMIENTO DE MORADA</option>
<option value="OTRO">OTRO</option>
</select>
<input id="delitoOtroTexto" placeholder="Especificar y pulsar Enter" style="display:none;" type="text"/>
<div id="delitosSeleccionados" style="color: red; margin-top:8px; padding:5px; border:1px solid #ccc; min-height:30px;">
<em>Ning√∫n delito seleccionado</em>
</div>
</div>
<div class="field-card" style="color: lightgreen;"><label>Indicativo</label><input id="indicativotexto" list="indicativos" name="Indicativo" placeholder="Am√©ricas 1 y 2" required="" type="text"/></div>
<div class="field-card" style="color: lightgreen;"><label>C.P. Agentes</label><input id="agentestexto" name="C.P. AGENTES" required="" type="text"/></div>
<div class="field-card" style="color: lightgreen;"><label>Diligencias</label><input id="diligenciatexto" name="DILIGENCIAS" type="text"/></div>
<div class="field-card" style="color: lightgreen;"><label>Instructor</label><input id="instructortexto" name="INSTRUCTOR" type="number"/></div>
<div class="field-card" style="color: lightgreen;">
<label>Lugar del hecho</label>
<select id="munHechoSel" required>
<option value="">-- Seleccionar --</option>
<option value="ADEJE">ADEJE</option>
<option value="ARONA">ARONA</option>
<option value="OTRO">OTRO</option>
</select>
<input id="viaHecho" placeholder="Coincide callejero" style="display:none; margin-top:6px; width:100%; order:3;" type="text" required/>
<input id="restoHecho" placeholder="Resto direcci√≥n..." style="display:none; margin-top:6px; width:100%; order:4;" type="text"/>
<input id="munHechoOtro" placeholder="Municipio (si elegiste OTRO)" style="display:none; margin-top:6px; width:100%; order:2;" type="text"/>
<input id="lugarHechoHidden" name="LUGAR DEL HECHO" type="hidden"/>
</div>
<div class="field-card" style="color: lightgreen;">
<label>Lugar de la detenci√≥n</label>
<select id="munDetSel" required>
<option value="">-- Seleccionar --</option>
<option value="ADEJE">ADEJE</option>
<option value="ARONA">ARONA</option>
<option value="OTRO">OTRO</option>
</select>
<input id="viaDet" placeholder="Coincide callejero" style="display:none; margin-top:6px; width:100%; order:3;" type="text" required/>
<input id="restoDet" placeholder="Resto direcci√≥n..." style="display:none; margin-top:6px; width:100%; order:4;" type="text"/>
<input id="munDetOtro" placeholder="Municipio (si elegiste OTRO)" style="display:none; margin-top:6px; width:100%; order:2;" type="text"/>
<input id="lugarDetHidden" name="LUGAR DE LA DETENCI√ìN" type="hidden"/>
</div>
<script>
(function(){
  const form = document.getElementById('registroForm');

  const selH = document.getElementById('munHechoSel');
  const viaH = document.getElementById('viaHecho');
  const otroH = document.getElementById('munHechoOtro');
  const hidH = document.getElementById('lugarHechoHidden');
  const restoH = document.getElementById('restoHecho');

  const selD = document.getElementById('munDetSel');
  const viaD = document.getElementById('viaDet');
  const otroD = document.getElementById('munDetOtro');
  const hidD = document.getElementById('lugarDetHidden');
  const restoD = document.getElementById('restoDet');

  
  function compose(via, resto, _muni){
    const v = String(via||'').trim();
    const r = String(resto||'').trim();
    
    return v ? (r ? (v + ' ' + r) : v) : (r || '');
  }
  function muniFromSelection(selEl, otroEl){
    if (!selEl) return '';
    const v = selEl.value;
    if (v === 'OTRO') return (otroEl?.value||'');
    return v || '';
  }
  function updateHecho(evt){
    if (!selH || !viaH || !hidH) return;
    const choice = selH.value;
    const fromTyping = evt && evt.type === 'input' && (evt.target === viaH || evt.target === otroH);

    otroH.style.display = (choice === 'OTRO') ? 'block' : 'none';
    viaH.style.display  = choice ? 'block' : 'none';
    if (restoH) { restoH.style.display = (viaH.value || restoH.value) ? 'block' : 'none'; }
    const muni = muniFromSelection(selH, otroH);
    hidH.value = compose(viaH.value, (restoH?.value||''), muni);
    if (form) form.setAttribute('data-mun-hecho', String(muni).toUpperCase());

    if (!fromTyping) {
      if (choice === 'OTRO') { if (otroH) otroH.focus(); }
      else if (choice === 'ADEJE' || choice === 'ARONA') { if (viaH) viaH.focus(); }
    }
  }
  function updateDet(evt){
    if (!selD || !viaD || !hidD) return;
    const choice = selD.value;
    const fromTyping = evt && evt.type === 'input' && (evt.target === viaD || evt.target === otroD);

    otroD.style.display = (choice === 'OTRO') ? 'block' : 'none';
    viaD.style.display  = choice ? 'block' : 'none';
    if (restoD) { restoD.style.display = (viaD.value || restoD.value) ? 'block' : 'none'; }
    const muni = muniFromSelection(selD, otroD);
    hidD.value = compose(viaD.value, (restoD?.value||''), muni);
    if (form) form.setAttribute('data-mun-detencion', String(muni).toUpperCase());

    if (!fromTyping) {
      if (choice === 'OTRO') { if (otroD) otroD.focus(); }
      else if (choice === 'ADEJE' || choice === 'ARONA') { if (viaD) viaD.focus(); }
    }
  }
  if (selH) { selH.addEventListener('input',  updateHecho, {passive:true}); selH.addEventListener('change', updateHecho, {passive:true}); }
  if (viaH) { viaH.addEventListener('input',  (e)=>updateHecho(e), {passive:true}); }
  if (otroH){ otroH.addEventListener('input', (e)=>updateHecho(e), {passive:true}); }

  if (selD) { selD.addEventListener('input',  updateDet, {passive:true}); selD.addEventListener('change', updateDet, {passive:true}); }
  if (viaD) { viaD.addEventListener('input',  (e)=>updateDet(e), {passive:true}); }
  if (otroD){ otroD.addEventListener('input', (e)=>updateDet(e), {passive:true}); }
  updateHecho(); updateDet();

  if (selH && viaH) {
    selH.addEventListener('click', ()=>{ viaH.style.display = 'block'; }, {passive:true});
    selH.addEventListener('change', ()=>{
      updateHecho();
      if (selH.value === 'OTRO') { if (otroH) try{ otroH.focus(); }catch(_){} }
      else { if (viaH) try{ viaH.focus(); }catch(_){} }
    }, {passive:true});
  }

  if (selD && viaD) {
    selD.addEventListener('click', ()=>{ viaD.style.display = 'block'; }, {passive:true});
    selD.addEventListener('change', ()=>{
      updateDet();
      if (selD.value === 'OTRO') { if (otroD) try{ otroD.focus(); }catch(_){} }
      else { if (viaD) try{ viaD.focus(); }catch(_){} }
    }, {passive:true});
  }

  
  function esValidaEnCallejero(muni, via){
    try {
      if (typeof window.esCalleValida === 'function') return !!window.esCalleValida(muni, via);
    } catch(_) {}
    
    return true;
  }
  function validarViaYMostrarResto(selEl, viaEl, restoEl, hidEl, otroEl){
    const muni = muniFromSelection(selEl, otroEl);
    if (!selEl || !viaEl || !hidEl) return;

    
    if (!muni || String(muni).toUpperCase() === 'OTRO'){
      if (restoEl) restoEl.style.display = (viaEl.value.trim() || (restoEl?.value||'').trim()) ? 'block' : 'none';
      hidEl.value = compose(viaEl.value, (restoEl?.value||''), ''); 
      return;
    }

    
    const ok = esValidaEnCallejero(muni, viaEl.value);
    if (!ok){
      
      if (restoEl) restoEl.style.display = (viaEl.value.trim() || (restoEl?.value||'').trim()) ? 'block' : 'none';
      hidEl.value = compose(viaEl.value, (restoEl?.value||''), '');
      const panel = document.getElementById('message');
      if (panel){
        panel.textContent = '‚ö†Ô∏è La v√≠a debe existir en el callejero de ' + String(muni).toUpperCase() + '.';
        panel.style.color = '#ffcc66';
      }
      return;
    }

    
    if (restoEl){
      restoEl.style.display = 'block';
    }
    hidEl.value = compose(viaEl.value, (restoEl?.value||''), '');
  }

  
  if (viaH) { viaH.addEventListener('blur',  ()=>validarViaYMostrarResto(selH, viaH, restoH, hidH, otroH), {passive:true}); }
  if (viaD) { viaD.addEventListener('blur',  ()=>validarViaYMostrarResto(selD, viaD, restoD, hidD, otroD), {passive:true}); }
  if (restoH) { restoH.addEventListener('input', ()=>{ const m = muniFromSelection(selH, otroH); hidH.value = compose(viaH.value, restoH.value, m); }, {passive:true}); }
  if (restoD) { restoD.addEventListener('input', ()=>{ const m = muniFromSelection(selD, otroD); hidD.value = compose(viaD.value, restoD.value, m); }, {passive:true}); }

  document.addEventListener('DOMContentLoaded', ()=> {
    try {
      updateHecho();
      updateDet();
      if (selH && viaH && selH.value) { viaH.style.display = 'block'; }
      if (selD && viaD && selD.value) { viaD.style.display = 'block'; }
      
      setTimeout(()=>{ try{ updateHecho(); }catch(_){} }, 0);
      setTimeout(()=>{ try{ updateDet(); }catch(_){} }, 0);
    } catch(_e){}
  }, {once:true});

})();
</script>
<script>
(function callesMunicipales(){
  const viaH   = document.getElementById('viaHecho');
  const viaD   = document.getElementById('viaDet');
  const selH   = document.getElementById('munHechoSel');
  const selD   = document.getElementById('munDetSel');
  const restoH = document.getElementById('restoHecho');
  const restoD = document.getElementById('restoDet');
  if (!viaH && !viaD) return;

  // ‚îÄ‚îÄ datalists para las v√≠as ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let dlH = document.getElementById('listaViaHecho');
  if (!dlH){
    dlH = document.createElement('datalist');
    dlH.id = 'listaViaHecho';
    document.body.appendChild(dlH);
  }
  let dlD = document.getElementById('listaViaDet');
  if (!dlD){
    dlD = document.createElement('datalist');
    dlD.id = 'listaViaDet';
    document.body.appendChild(dlD);
  }
  if (viaH) viaH.setAttribute('list','listaViaHecho');
  if (viaD) viaD.setAttribute('list','listaViaDet');

  let DB        = null;
  let DBloaded  = false;
  let unionBase = [];       // todas las calles ADEJE+ARONA precalculadas

  async function loadDB(){
    if (DB) return DB;
    if (typeof window.CALLEJERO !== 'undefined' && window.CALLEJERO){
      DB = window.CALLEJERO;
      return DB;
    }
    DB = {};
    try{
      const panel = document.getElementById('message');
      if (panel){
        panel.textContent = '‚ö†Ô∏è No se ha cargado ./calles.js (callejero). Abre este archivo con calles.js en la misma carpeta.';
        panel.style.color = '#ffcc66';
      }
    }catch(_){}
    return DB;
  }

  function buildOptionsForMunicipio(muni){
    const U = (s)=>String(s||'').trim().toUpperCase();
    const src = (DB && DB[U(muni)]) ? DB[U(muni)] : null;
    if (!src) return [];
    const out = [];
    Object.keys(src).forEach(tipo=>{
      const arr = Array.isArray(src[tipo]) ? src[tipo] : [];
      for (const nombre of arr){
        const base = String(nombre).replace(new RegExp('^'+tipo+'\\s+','i'), '');
        const full = `${tipo} ${base}`; // "CALLE Mayor"
        out.push(full);
      }
    });
    out.sort((a,b)=>a.localeCompare(b,'es'));
    return out;
  }

  function renderList(dl, items){
    if (!dl) return;
    dl.innerHTML = '';
    const frag = document.createDocumentFragment();
    for (const v of items){
      const o = document.createElement('option');
      o.value = v;
      frag.appendChild(o);
    }
    dl.appendChild(frag);
  }

  function buildUnionBase(){
    // se llama SOLO una vez, cuando ya est√° DB
    const a = buildOptionsForMunicipio('ADEJE');
    const b = buildOptionsForMunicipio('ARONA');
    const set = new Set([...(a||[]), ...(b||[])]);
    unionBase = Array.from(set).sort((x,y)=>x.localeCompare(y,'es'));
  }

  function getFiltradas(frag){
    if (!unionBase.length) return [];
    const f = String(frag||'').trim().toLowerCase();
    // si no hay texto o menos de 2 caracteres, no saturamos
    if (!f || f.length < 2) {
      return unionBase.slice(0, 80);
    }
    const res = unionBase.filter(v => v.toLowerCase().includes(f));
    return res.slice(0, 80); // l√≠mite duro de sugerencias
  }

  function refreshHecho(frag){
    if (!dlH || !DBloaded) return;
    renderList(dlH, getFiltradas(frag));
  }
  function refreshDet(frag){
    if (!dlD || !DBloaded) return;
    renderList(dlD, getFiltradas(frag));
  }

  async function ensureLoaded(){
    if (DBloaded) return;
    await loadDB();
    buildUnionBase();
    DBloaded = true;

    // helpers globales para validaci√≥n
    try {
      window.callejeroOpciones = (muni, frag)=>{
        if (!DBloaded) return [];
        const f = String(frag||'').trim().toLowerCase();
        return getFiltradas(f);
      };
      window.esCalleValida = (muni, via)=>{
        if (!DBloaded) return true;
        const U = s=>String(s||'').trim().toUpperCase();
        const lista = getFiltradas('');
        return lista.some(o => U(o) === U(via));
      };
    } catch(_){}

    refreshHecho(viaH ? viaH.value : '');
    refreshDet(viaD ? viaD.value : '');
  }

  // ‚îÄ‚îÄ disparar carga al enfocar cualquier campo relevante ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (viaH)   viaH.addEventListener('focus',  ()=>{ ensureLoaded(); }, { once:true });
  if (selH)   selH.addEventListener('focus',  ()=>{ ensureLoaded(); }, { once:true });
  if (restoH) restoH.addEventListener('focus',()=>{ ensureLoaded(); }, { once:true });

  if (viaD)   viaD.addEventListener('focus',  ()=>{ ensureLoaded(); }, { once:true });
  if (selD)   selD.addEventListener('focus',  ()=>{ ensureLoaded(); }, { once:true });
  if (restoD) restoD.addEventListener('focus',()=>{ ensureLoaded(); }, { once:true });

  // ‚îÄ‚îÄ filtrado din√°mico con debounce ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let tH = null, tD = null;
  if (viaH) viaH.addEventListener('input', ()=>{
    if (!DBloaded) return;
    clearTimeout(tH);
    tH = setTimeout(()=>refreshHecho(viaH.value), 80);
  }, {passive:true});

  if (viaD) viaD.addEventListener('input', ()=>{
    if (!DBloaded) return;
    clearTimeout(tD);
    tD = setTimeout(()=>refreshDet(viaD.value), 80);
  }, {passive:true});

})();
</script>
<div class="field-card" style="color: lightgreen;"><label>Hora del hecho</label><input id="horaHecho" name="HORA DEL HECHO" required="" type="time"/></div>
<div class="field-card" style="color: lightgreen;"><label>Hora de la detenci√≥n</label><input id="horaDetencion" name="HORA DE LA DETENCI√ìN" required="" type="time"/></div>
<div class="field-card" style="color: lightgreen;">
<label>Breve resumen de los hechos</label><textarea id="brevetexto" name="BREVE RESUMEN DE LOS HECHOS" required=""></textarea>
</div>
<div class="field-card" style="color: lightgreen;">
<label>Indicios por los que se detiene</label><textarea id="indiciostexto" name="INDICIOS POR LOS QUE SE DETIENE" required=""></textarea>
</div>
</div>
<h2> </h2>
<div class="grid-rows">
<div class="field-card" style="color: orange;">
<label>Abogado</label>
<select id="abogadoOpcion" name="ABOGADO_OPCION">
<option selected="" value="DE OFICIO">DE OFICIO</option>
<option value="OTRO">PARTICULAR</option>
</select>
<input id="abogadoTexto" name="ABOGADO" placeholder="Nombre y tel√©fono" style="display:none;" type="text"/>
</div>
<div class="field-card" style="color: orange;">
<label>Comunicarse con</label>
<select id="comunicarseOpcion" name="COMUNICARSE CON_OPCION">
<option selected="" value="NADIE">NADIE</option>
<option value="OTRO">OTRO</option>
</select>
<input id="comunicarseTexto" name="COMUNICARSE CON:" placeholder="Nombre y tel√©fono" style="display:none;" type="text"/>
</div>
<div class="field-card" style="color: orange;">
<label>Informar de detenci√≥n</label>
<select id="informardeOpcion" name="INFORMAR DE DETENCION_OPCION">
<option selected="" value="NADIE">NADIE</option>
<option value="OTRO">OTRO</option>
</select>
<input id="informardeTexto" name="INFORMAR DE DETENCION" placeholder="Nombre y tel√©fono" style="display:none;" type="text"/>
</div>
<div class="field-card" style="color: orange;">
<label>Int√©rprete</label>
<select id="interpreteOpcion" name="INTERPRETE_OPCION">
<option selected="" value="NO">NO</option>
<option value="INGL√âS">INGL√âS</option>
<option value="√ÅRABE">√ÅRABE</option>
<option value="ITALIANO">ITALIANO</option>
<option value="RUSO">RUSO</option>
<option value="OTRO">OTRO</option>
</select>
<input id="idioma" name="IDIOMA" placeholder="Especificar idioma/contexto" style="display:none;" type="text"/>
</div>
<div class="field-card" style="color: orange;">
<label>M√©dico</label>
<select id="medico" name="MEDICO">
<option selected="" value="NO">NO</option>
<option value="SI">SI</option>
</select>
</div>
<div class="field-card" style="color: orange;">
<label>Consulado</label>
<select id="consulado" name="CONSULADO">
<option selected="" value="NO">NO</option>
<option value="SI">SI</option>
</select>
</div>
</div>
<datalist id="indicativos">
<option value="Am√©rica"></option>
<option value="Troya"></option>
<option value="Chacal"></option>
<option value="Faro Adeje"></option>
</datalist>
</form>
<div class="actions actions-outside">
<input accept=".json" id="fileInputJSON" style="display:none" type="file"/>
<button class="zip" onclick="exportarJSON()" type="button">üíæ DESCARGAR JSON ‚¨áÔ∏è</button>
<button class="xlsx" onclick="importarJSON()" type="button">üìÅ IMPORTAR JSON ‚¨ÜÔ∏è</button>
<button class="refresh" onclick="location.reload();" type="button">üîÑ ¬†¬† REFRESCAR ¬†¬† üîÑ</button>
<button id="goRoaBtn" style="display:none" type="button">‚û°Ô∏è Ir a R.O.A.</button>
</div>
<div id="message"></div>
<script>
    function sanitizeForFilename(s){return String(s||'').replace(/[\/\:*?"<>|]+/g,' ').trim();}
    function U(s){ return String(s ?? '').toUpperCase(); } 

    // Minimal helper for indocumentado label
    function updateIndocumentadoUI(useImported){
      // No longer needed with split options
    }

    document.addEventListener('change',e=>{
      if(e.target.id==="tipoDocumento"){
        const val=e.target.value;
        document.getElementById('tipoDocumentoOtro').style.display=(val==="OTRO")?"block":"none";
        const num=document.getElementById("numeroDocumento");
        const vv = String(val).toUpperCase();
        if(vv==="INDOCUMENTADO" || vv==="INDOCUMENTADA"){ num.value=""; num.disabled=true; } else { num.disabled=false; }
      }
      if (e.target.id === "sexoOpcion") {
        const tipo = document.getElementById('tipoDocumento');
        if (!tipo) return;
        const sex = (e.target.value||'').toUpperCase();
        // Only auto-switch if currently indocumentado/indocumentada
        const v = (tipo.value||'').toUpperCase();
        if (v === "INDOCUMENTADO" || v === "INDOCUMENTADA") {
          tipo.value = (sex === "FEMENINO") ? "INDOCUMENTADA" : "INDOCUMENTADO";
          tipo.dispatchEvent(new Event('change'));
        }
      }
      if(e.target.id==="interpreteOpcion"){
        document.getElementById('idioma').style.display=(e.target.value==="OTRO")?"block":"none";
      }
      if(e.target.tagName==="SELECT" && e.target.closest('.field-card')){
        const input=e.target.closest('.field-card').querySelector('input[type="text"]');
        if(input && !["tipoDocumento","interpreteOpcion"].includes(e.target.id)){
          input.style.display=(e.target.value==="OTRO")?"block":"none";
        }
      }
    });

    const selectDelito = document.getElementById("delitoSelect");
    const lista = document.getElementById("delitosSeleccionados");
    const inputOtro = document.getElementById("delitoOtroTexto");
    let delitosElegidos = [];

    selectDelito.addEventListener("change", ()=>{
      const val = selectDelito.value;
      if (val === "OTRO") { inputOtro.style.display = "inline-block"; inputOtro.focus(); return; }
      if (val && !delitosElegidos.includes(val)) { delitosElegidos.push(val); renderDelitos(); }
      selectDelito.value = "";
    });

    inputOtro.addEventListener("keydown", e=>{
      if(e.key==="Enter"){
        e.preventDefault();
        const val = inputOtro.value.trim();
        if(val && !delitosElegidos.includes(val)){ delitosElegidos.push(val); renderDelitos(); }
        inputOtro.value=""; inputOtro.style.display="none"; selectDelito.value="";
      }
    });

   function renderDelitos() {
  lista.innerHTML = "";
  if (delitosElegidos.length === 0) {
    lista.innerHTML = '<em style="color: red; font-style: normal;">Ning√∫n delito seleccionado</em>';
  } else {
    delitosElegidos.forEach((d, i) => {
      const span = document.createElement("span");
      span.textContent = d;
      span.style.cssText = "padding:3px 6px; margin:2px; background:linear-gradient(90deg,#b8d9f1,#bea4fa); border:1px solid #99c; border-radius:4px; display:inline-block; cursor:pointer;";
      span.title = "Click para eliminar";
      span.addEventListener("click", () => {
        delitosElegidos.splice(i, 1);
        renderDelitos();
      });
      lista.appendChild(span);
    });
  }

  
  const contenedor = document.getElementById("delitosSeleccionados");
  if (contenedor) {
    if (delitosElegidos.length > 0) {
      contenedor.style.border = "1px solid #00ff7f";   
      contenedor.style.color = "#222";                 
    } else {
      contenedor.style.border = "1px solid #cc0000";   
      contenedor.style.color = "#cc0000";              
    }
  }
}
renderDelitos(); 
    
    function normalizeKey(str) {
      return str
        ? str.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().replace(/[^A-Z0-9]/g,"").trim()
        : "";
    }

    
    function setSelectWithInput(selectName, excelValue) {
      const select = document.querySelector(`[name="${selectName}"]`);
      if (!select) return;
      const card = select.closest(".field-card");
      const textInput = card ? card.querySelector("input[type=text], textarea") : null;
      const normExcel = normalizeKey(excelValue);

      let matched = false;
      for (const opt of select.options) {
        if (normalizeKey(opt.value) === normExcel) {
          select.value = opt.value;
          matched = true;
          if (textInput) { textInput.value = ""; textInput.style.display = "none"; }
          break;
        }
      }

      if (!matched) {
        if (!excelValue || ["NOAPORTA","NO","DEOFICIO"].includes(normExcel)) {
          const fallback = Array.from(select.options).find(opt =>
            ["NOAPORTA","NO","DEOFICIO"].includes(normalizeKey(opt.value))
          );
          if (fallback) select.value = fallback.value;
          if (textInput) { textInput.value = ""; textInput.style.display = "none"; }
        } else {
          const otherOpt = Array.from(select.options).find(opt => normalizeKey(opt.value) === "OTRO");
          if (otherOpt) select.value = otherOpt.value;
          if (textInput) { textInput.value = excelValue; textInput.style.display = "block"; }
        }
      }
    }

    
    async function saveBlobJson(text, filename){
      const ensureJsonName = (name)=>{
        const n = String(name || '').trim();
        return n.toLowerCase().endsWith('.json') ? n : (n + '.json');
      };
      const safeName = ensureJsonName(filename);
      const blob = new Blob([text], { type: 'application/json;charset=utf-8' });

      
      if (typeof window.showSaveFilePicker === 'function') {
        const handle = await window.showSaveFilePicker({
          suggestedName: safeName,
          types: [{ description: 'JSON', accept: { 'application/json': ['.json'] } }],
          excludeAcceptAllOption: false
        });
        const writable = await handle.createWritable();
        await writable.write(blob);
        await writable.close();
        return;
      }

      
      alert('Tu navegador no permite seleccionar carpeta (no soporta File System Access API en este contexto). Se usar√° descarga directa.');
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = safeName;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1500);
    }

    const RUTA_ROA = "./js/roa.html";

function splitApellidos(s){
  s = String(s||"").trim();
  if(!s) return {primer:"",segundo:""};
  const p = s.split(/\s+/);
  return {primer:p[0]||"", segundo:p.slice(1).join(" ")};
}

function sexoAHoM(v){
  const Uv = String(v||"").toUpperCase();
  if(Uv.startsWith("MASC")) return "H";
  if(Uv.startsWith("FEM"))  return "M";
  return "";
}

function buildRoaPayloadFromRegistro(data){
  const ap = splitApellidos(data["APELLIDOS"]);

  const domDisplay = (data["DOMICILIO_OPCION"]==="APORTA")
    ? ((document.getElementById('direccionDomicilio')?.value)||data["DOMICILIO"]||"")
    : (data["DOMICILIO_OPCION"]||"");

  const telDisplay = (data["TEL√âFONO_OPCION"]==="OTRO")
    ? (data["TEL√âFONO"]||"")
    : (data["TEL√âFONO_OPCION"]||"");

  const tipoDoc = data["TIPO DOCUMENTO_OPCION"]==="OTRO"
    ? (data["TIPO DOCUMENTO"]||"")
    : (data["TIPO DOCUMENTO_OPCION"]||"");

  // Datos de nacimiento para ROA
  const paisNac = (document.getElementById('paisNacimiento')?.value || "").trim();
  const lugarFull = (data["LUGAR DE NACIMIENTO"] || "").trim();

  let muniNac = "";
  let provNac = "";

  if (lugarFull) {
    // Si es Espa√±a, el hidden viene como "Municipio, Provincia"
    const P = paisNac.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase();
    const esES = (P === "ESPA√ëA" || P === "ESPANA" || P === "ES");
    if (lugarFull.includes(",") && esES) {
      const idx = lugarFull.lastIndexOf(",");
      muniNac = lugarFull.slice(0, idx).trim();
      provNac = lugarFull.slice(idx + 1).trim();
    } else {
      // Extranjero o sin coma: dejamos todo en "municipio" y provincia vac√≠a
      muniNac = lugarFull;
      provNac = "";
    }
  }

  return {
    "TIPO DOCUMENTO": tipoDoc,
    "N√öMERO DE DOCUMENTO": data["N¬∫DOCUMENTO"] || "",
    "NOMBRE": data["Nombre"] || "",
    "PRIMER APELLIDO": ap.primer,
    "SEGUNDO APELLIDO": ap.segundo,
    "FECHA DE NACIMIENTO": data["FECHA DE NACIMIENTO"] || "",
    "LUGAR DE NACIMIENTO": muniNac || "",
    "PROVINCIA": provNac || "",
    "PA√çS": paisNac || "",
    "NACIONALIDAD": data["NACIONALIDAD"] || "",
    "NOMBRE DE LOS PADRES": (data["NOMBRE_PADRES_OPCION"]==="OTRO"
      ? (data["NOMBRE_PADRES"]||"")
      : (data["NOMBRE_PADRES_OPCION"]||"")),
    "PROFESI√ìN": "",
    "TEL√âFONO": telDisplay,
    "DOMICILIOS": domDisplay,
    "ARMAS":"", "ALIAS":"", "CONSORTES":"", "EMPRESAS":"",
    "LUGARES DE ACTUACION":"", "LUGARES DE FRECUENCIA":"", "ORGANIZACION":"",
    "SEXO": sexoAHoM(data["SEXO_OPCION"]),
    "TALLA":"", "COMPLEXION":"", "RAZA":"", "ACENTO":"", "CEJAS":"",
    "LABIOS":"", "MENTON":"", "CARA":"", "PELO":"", "OJOS":"",
    "NARIZ":"", "OREJAS":"", "MARCAS":"", "USAS":"", "VEHICULOS":"",
    "DILIGENCIAS": data["DILIGENCIAS"] || "",
    "FECHA DILIGENCIAS": data["FECHA_GENERACION"] || "",
    "RESUMEN DILIGENCIAS": "",
    "FUNCIONARIO EMISOR":"",
    "FECHA DE CUMPLIMENTACION":""
  };
}
    function validarRequeridos() {
      const form = document.getElementById('registroForm');
      if (!form) return true;
      var divDelitos = document.getElementById('delitosSeleccionados');
      if (divDelitos) {
        var txt = (divDelitos.textContent || '').trim();
        if (txt.indexOf('Ning√∫n delito seleccionado') !== -1 || txt.indexOf('Ningun delito seleccionado') !== -1) {
          alert('‚ö†Ô∏è Debes seleccionar al menos un delito.');
          return false;
        }
      }
      const invalidos = Array.from(form.querySelectorAll('[required]')).filter(el => !el.value.trim());
      if (invalidos.length > 0) {
        alert("‚ö†Ô∏è Faltan campos obligatorios por rellenar:\n\n- " + invalidos.map(el => el.previousElementSibling?.innerText || el.name || el.id).join("\n- "));
        invalidos[0].focus();
        return false;
      }
      return true;
    }

    function validarPais(value, listId){
  const v = (value||"").trim().toUpperCase();
  const opts = [...document.querySelectorAll(`#${listId} option`)]
               .map(o => o.value.toUpperCase());
  return opts.includes(v);
}

function validarPaisesRegistro(){
  const nac = document.getElementById("nacionalidadInput").value;
  const paisNac = document.getElementById("paisNacimiento").value;

  if (!validarPais(nac,"listaNacionalidad")){
    alert("‚ö†Ô∏è La nacionalidad debe coincidir con un pa√≠s del listado.");
    return false;
  }
  if (!validarPais(paisNac,"listaPaisNacimiento")){
    alert("‚ö†Ô∏è El pa√≠s de nacimiento debe coincidir con un pa√≠s del listado.");
    return false;
  }
  return true;
}

function validarIndicativo(){
  const inp = document.getElementById('indicativotexto');
  if (!inp) return true;
  let v = (inp.value||'').trim();
  if (!v) return true; // el required ya se controla en validarRequeridos
  v = v.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase();
  const opts = [...document.querySelectorAll('#indicativos option')]
               .map(o => (o.value||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase())
               .filter(Boolean);
  const ok = opts.some(t => v.includes(t));
  if (!ok){
    alert('‚ö†Ô∏è El indicativo debe contener al menos una de las opciones del listado (Am√©rica, Troya, Chacal o Faro Adeje).');
    inp.focus();
    return false;
  }
  return true;
}

    const _exportarJSON = window.exportarJSON;
    window.exportarJSON = async function(){
      if (!validarRequeridos()) return;
      if (!validarPaisesRegistro()) return;
      if (!validarIndicativo()) return;
      return _exportarJSON.apply(this, arguments);
    };

    async function exportarJSON(){
      if (!validarRequeridos()) return;
      if (!validarPaisesRegistro()) return;
      if (!validarIndicativo()) return;
      const msg = document.getElementById("message");
      msg.innerText = "Generando JSON...";
      // Coordenadas gestionadas desde Compapol; no son obligatorias en este formulario.

      // === REQUISITO: LUGAR DEL HECHO y DETENCI√ìN OBLIGATORIOS (municipio + v√≠a del callejero) ===
      (function(){
        const msg = document.getElementById('message');
        const selH = document.getElementById('munHechoSel');
        const viaH = document.getElementById('viaHecho');
        const selD = document.getElementById('munDetSel');
        const viaD = document.getElementById('viaDet');
        const U = s => String(s||'').trim().toUpperCase();
        const esVal = (m,v)=>{
          try{ return (typeof window.esCalleValida === 'function') ? !!window.esCalleValida(m,v) : true; }catch(_){ return true; }
        };
        // Hecho
        const mH = U(selH && selH.value);
        const vH = viaH && viaH.value;
        if (!mH || mH==='OTRO'){
          if (msg) { msg.innerText='‚ö†Ô∏è Selecciona municipio del hecho (ADEJE o ARONA).'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è Selecciona municipio del hecho (ADEJE o ARONA).');
          if (selH) selH.focus();
          throw new Error('Falta municipio del hecho');
        }
        if (!vH){
          if (msg) { msg.innerText='‚ö†Ô∏è Escribe la v√≠a del hecho.'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è Escribe la v√≠a del hecho.');
          if (viaH) viaH.focus();
          throw new Error('Falta v√≠a del hecho');
        }
        if (!esVal(mH, vH)){
          if (msg) { msg.innerText='‚ö†Ô∏è La v√≠a del hecho debe existir en el callejero de '+mH+'.'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è La v√≠a del hecho debe existir en el callejero de '+mH+'.');
          if (viaH) viaH.focus();
          throw new Error('V√≠a del hecho no v√°lida');
        }
        // Detenci√≥n
        const mD = U(selD && selD.value);
        const vD = viaD && viaD.value;
        if (!mD || mD==='OTRO'){
          if (msg) { msg.innerText='‚ö†Ô∏è Selecciona municipio de la detenci√≥n (ADEJE o ARONA).'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è Selecciona municipio de la detenci√≥n (ADEJE o ARONA).');
          if (selD) selD.focus();
          throw new Error('Falta municipio detenci√≥n');
        }
        if (!vD){
          if (msg) { msg.innerText='‚ö†Ô∏è Escribe la v√≠a de la detenci√≥n.'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è Escribe la v√≠a de la detenci√≥n.');
          if (viaD) viaD.focus();
          throw new Error('Falta v√≠a detenci√≥n');
        }
        if (!esVal(mD, vD)){
          if (msg) { msg.innerText='‚ö†Ô∏è La v√≠a de la detenci√≥n debe existir en el callejero de '+mD+'.'; msg.style.color='#ff6f00'; }
          alert('‚ö†Ô∏è La v√≠a de la detenci√≥n debe existir en el callejero de '+mD+'.');
          if (viaD) viaD.focus();
          throw new Error('V√≠a detenci√≥n no v√°lida');
        }
      })();

      try{
        const form = document.getElementById("registroForm");
        const fd = new FormData(form);
        const data = {}; fd.forEach((v,k)=>data[k]=v);

        const UPP = s => String(s ?? '').trim();
        function toESDate(s){
          const t = String(s||'').trim();
          let m = t.match(/^(\d{4})-(\d{2})-(\d{2})$/);
          if (m) return `${m[3]}/${m[2]}/${m[1]}`;
          m = t.match(/^(\d{2})[\/\-](\d{2})[\/\-](\d{4})$/);
          if (m) return `${m[1]}/${m[2]}/${m[3]}`;
          return t;
        }

        const optTD = data["TIPO DOCUMENTO_OPCION"];
        const up = String(optTD||"").toUpperCase();
        if (up === "INDOCUMENTADO" || up === "INDOCUMENTADA") {
          data["TIPO DOCUMENTO"] = (up === "INDOCUMENTADA") ? "Indocumentada" : "Indocumentado";
        } else if (optTD === "OTRO") {
          data["TIPO DOCUMENTO"] = data["TIPO DOCUMENTO"]||"";
        } else {
          data["TIPO DOCUMENTO"] = optTD;
        }
        data["N¬∫DOCUMENTO"] = (up === "INDOCUMENTADO" || up === "INDOCUMENTADA") ? "" : (data["N¬∫DOCUMENTO"] || "");
        data["SEXO"] = data["SEXO_OPCION"] || "";
        data["INSTRUCTOR"] = data["INSTRUCTOR"] || "";
        data["FECHA_GENERACION"] = document.getElementById('fechaGeneracion')?.value || '';

        let delitoTexto = "";
        if (typeof delitosElegidos !== "undefined") {
          if (delitosElegidos.length === 1) delitoTexto = delitosElegidos[0];
          else if (delitosElegidos.length === 2) delitoTexto = delitosElegidos[0] + " y " + delitosElegidos[1];
          else if (delitosElegidos.length > 2) delitoTexto = delitosElegidos.slice(0,-1).join(", ") + " y " + delitosElegidos[delitosElegidos.length-1];
        }
        data["DELITO"] = delitoTexto;

        const abOpt = data["ABOGADO_OPCION"];
        data["ABOGADO"] = (abOpt === "DE OFICIO") ? "de oficio." : (abOpt === "OTRO" ? (data["ABOGADO"]||"") : (data["ABOGADO"]||""));

        const ccOpt = data["COMUNICARSE CON_OPCION"];
        data["COMUNICARSE CON:"] = (ccOpt === "NADIE") ? "nadie." : (ccOpt === "OTRO" ? (data["COMUNICARSE CON:"]||"") : (data["COMUNICARSE CON:"]||""));

        const infOpt = data["INFORMAR DE DETENCION_OPCION"];
        data["INFORMAR DE DETENCION"] = (infOpt === "NADIE") ? "nadie." : (infOpt === "OTRO" ? (data["INFORMAR DE DETENCION"]||"") : (data["INFORMAR DE DETENCION"]||""));

        const intOpt = data["INTERPRETE_OPCION"] || "NO";
        let interpreteDisplay = "NO";
        if (intOpt === "OTRO") interpreteDisplay = data["IDIOMA"] || "";
        else if (intOpt !== "NO") interpreteDisplay = intOpt;
        data["IDIOMA"] = interpreteDisplay;
        data["INTERPRETE"] = interpreteDisplay;

        const nomDisplay = (data["NOMBRE_PADRES_OPCION"]==="OTRO") ? (data["NOMBRE_PADRES"]||"") : (data["NOMBRE_PADRES_OPCION"]||"");
        const domDisplay = (data["DOMICILIO_OPCION"]==="APORTA") ? ((document.getElementById('direccionDomicilio')?.value) || data["DOMICILIO"] || "") : (data["DOMICILIO_OPCION"]||"");
        const telDisplay = (data["TEL√âFONO_OPCION"]==="OTRO") ? (data["TEL√âFONO"]||"") : (data["TEL√âFONO_OPCION"]||"");

        data["NOMBRE_PADRES"] = nomDisplay;
        data["Nombre de los Padres"] = nomDisplay;
        data["DOMICILIO"] = domDisplay;
        data["TEL√âFONO"] = telDisplay;

        data["MEDICO"] = (data["MEDICO"]==="SI") ? "SI" : "NO";
        data["CONSULADO"] = (data["CONSULADO"]==="SI") ? "SI" : "NO";

        const hoy = new Date();
        const dd = String(hoy.getDate()).padStart(2,'0');
        const mm = String(hoy.getMonth()+1).padStart(2,'0');
        const yyyy = String(hoy.getFullYear());
        const fechaStr = `${dd}-${mm}-${yyyy}`;

        
        if (!data["municipio-hecho"] && document.getElementById('munHechoSel')) {
          (function(){
            const sel = document.getElementById('munHechoSel');
            const otro = document.getElementById('munHechoOtro');
            const vSel = (sel?.value||'').trim().toUpperCase();
            const val = vSel==='OTRO' ? (otro?.value||'') : vSel;
            const up = String(val||'').trim().toUpperCase();
            data["municipio-hecho"] = up==='ADEJE' ? 'Adeje' : (up==='ARONA' ? 'Arona' : (String(val||'').trim().toLowerCase().replace(/\b([A-Za-z√Ä-√ñ√ò-√∂√∏-√ø])/g, m=>m.toUpperCase())));
          })();
        }
        if (!data["municipio-detencion"] && document.getElementById('munDetSel')) {
          (function(){
            const sel = document.getElementById('munDetSel');
            const otro = document.getElementById('munDetOtro');
            const vSel = (sel?.value||'').trim().toUpperCase();
            const val = vSel==='OTRO' ? (otro?.value||'') : vSel;
            const up = String(val||'').trim().toUpperCase();
            data["municipio-detencion"] = up==='ADEJE' ? 'Adeje' : (up==='ARONA' ? 'Arona' : (String(val||'').trim().toLowerCase().replace(/\b([A-Za-z√Ä-√ñ√ò-√∂√∏-√ø])/g, m=>m.toUpperCase())));
          })();
        }

        
        function titleCase(s){
          s = String(s||'').trim();
          if (!s) return '';
          return s.toLowerCase().replace(/\b([a-z√°√©√≠√≥√∫√º√±])/gi, m => m.toUpperCase());
        }
        function titleCaseParents(s){
          s = titleCase(s);
          return s.replace(/\b(De|Del|La|Los|Las|Y)\b/gi, m => m.toLowerCase());
        }
        function getTipoVia(via){
          const t = String(via||'').trim();
          if (!t) return '';
          const m = t.match(/^([A-Z√Å√â√ç√ì√ö√ú√ë]+|[A-Za-z√Å√â√ç√ì√ö√ú√ë]+)\b/);
          if (!m) return '';
          
          return titleCase(m[1]);
        }
        function normalizarViaConTipo(via){
          const v = String(via||'').trim();
          if (!v) return '';
          const tipo = getTipoVia(v);
          if (!tipo) return v;
          
          return v.replace(/^([A-Z√Å√â√ç√ì√ö√ú√ë]+|[A-Za-z√Å√â√ç√ì√ö√ú√ë]+)\b/, tipo);
        }
        
        function splitViaTipoNombre(via){
          const v = String(via||'').trim();
          if (!v) return { tipo:'', nombre:'' };
          const tipo = getTipoVia(v);
          if (!tipo) return { tipo:'', nombre:v };
          const nombre = v.replace(/^([A-Z√Å√â√ç√ì√ö√ú√ë]+|[A-Za-z√Å√â√ç√ì√ö√ú√ë]+)\b\s*/,'').trim();
          return { tipo, nombre };
        }
        function buildLugar(via, resto, muni){
          const v = normalizarViaConTipo(via);
          const r = String(resto||'').trim();
          const m = String(muni||'').trim();
          const dir = v ? (r ? (v + ' ' + r) : v) : (r || '');
          return m ? (dir ? `${dir}, ${m}` : m) : dir;
        }
        function getMuniFromUI(selId, otroId){
          const sel = document.getElementById(selId);
          const otro = document.getElementById(otroId);
          if (!sel) return '';
          const val = String(sel.value||'').trim();
          if (val.toUpperCase() === 'OTRO') return String(otro?.value||'').trim();
          return val;
        }

        
        const _viaHVal   = document.getElementById('viaHecho')?.value || '';
        const _restoHVal = document.getElementById('restoHecho')?.value || '';
        const _muniHVal  = getMuniFromUI('munHechoSel','munHechoOtro');
        const _tipoViaH  = getTipoVia(_viaHVal);
        
        const _viaHechoLower = (function(){
          const p = splitViaTipoNombre(_viaHVal);
          return (p.tipo ? (p.tipo + ' ' + p.nombre) : p.nombre);
        })();
        const _viasinHechoLower = splitViaTipoNombre(_viaHVal).nombre;
        const _lugarHechoFull = buildLugar(_viaHVal, _restoHVal, _muniHVal);

        
        const _viaDVal   = document.getElementById('viaDet')?.value || '';
        const _restoDVal = document.getElementById('restoDet')?.value || '';
        const _muniDVal  = getMuniFromUI('munDetSel','munDetOtro');
        const _tipoViaD  = getTipoVia(_viaDVal);
        const _viaDetLower = (function(){
          const p = splitViaTipoNombre(_viaDVal);
          return (p.tipo ? (p.tipo + ' ' + p.nombre) : p.nombre);
        })();
        const _viasinDetLower   = splitViaTipoNombre(_viaDVal).nombre;
        const _lugarDetFull = buildLugar(_viaDVal, _restoDVal, _muniDVal);

        const jsonOut = {
          "Nombre": titleCase(data["Nombre"]),
          "Apellidos": String(data["APELLIDOS"]||"").toUpperCase().trim(),
          "Tipo de documento": UPP(data["TIPO DOCUMENTO"]),
          "N¬∫ Documento": String(data["N¬∫DOCUMENTO"]||"").toUpperCase().trim(),
          "Sexo": UPP(data["SEXO"]),
          "Nacionalidad": titleCase(data["NACIONALIDAD"]),
          "Nombre de los Padres": titleCaseParents(data["Nombre de los Padres"]),
          "Fecha de nacimiento": UPP(toESDate(data["FECHA DE NACIMIENTO"])),
          "Lugar de nacimiento": UPP(data["LUGAR DE NACIMIENTO"]),
          "Domicilio": titleCase(domDisplay),
          "Tel√©fono": UPP(telDisplay),
          "Delito": UPP(data["DELITO"]),
          "C.P. Agentes": UPP(data["C.P. AGENTES"]),
          "Diligencias": UPP(data["DILIGENCIAS"]),
          "Instructor": UPP(data["INSTRUCTOR"]),
          "Lugar del hecho": _lugarHechoFull,
          "Lugar de la detenci√≥n": _lugarDetFull,
          "tipovia-hecho": _tipoViaH,
          "tipovia-detencion": _tipoViaD,
          "restodireccion-hecho": _restoHVal,
          "restodireccion-detencion": _restoDVal,
          "via-hecho": _viaHechoLower,
          "via-detencion": _viaDetLower,
          "viasin-hecho": _viasinHechoLower,
          "viasin-detencion": _viasinDetLower,
          "municipio-hecho": data["municipio-hecho"] || "",
          "municipio-detencion": data["municipio-detencion"] || "",
          "Hora del hecho": (document.getElementById('horaHecho')?.value || data["HORA DEL HECHO"] || "").trim(),
          "Hora de la detenci√≥n": (document.getElementById('horaDetencion')?.value || data["HORA DE LA DETENCI√ìN"] || "").trim(),
          "Breve resumen de los hechos": UPP(data["BREVE RESUMEN DE LOS HECHOS"]),
          "Indicios por los que se detiene": UPP(data["INDICIOS POR LOS QUE SE DETIENE"]),
          "Abogado": UPP(data["ABOGADO"]),
          "Comunicarse con": UPP(data["COMUNICARSE CON:"]),
          "Informar de detenci√≥n": UPP(data["INFORMAR DE DETENCION"]),
          "Int√©rprete": UPP(interpreteDisplay),
          "M√©dico": UPP(data["MEDICO"]),
          "Consulado": UPP(data["CONSULADO"]),
          "Indicativo": UPP(data["Indicativo"]),
          "Fecha de generaci√≥n": UPP(data["FECHA_GENERACION"]),
          "Condici√≥n": "Detenido"
        };

        
(function(){
  
  function _titleCase(s){
    s = String(s||'').toLowerCase().trim();
    if (!s) return "";
    return s.split(/\s+/).map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(" ");
  }
  function _capMuni(s){
    const u = String(s||'').trim().toUpperCase();
    if (u === 'ADEJE') return 'Adeje';
    if (u === 'ARONA') return 'Arona';
    return _titleCase(s);
  }
  
  let muniHecho = "";
  try{
    const selH = document.getElementById('munHechoSel');
    const otroH = document.getElementById('munHechoOtro');
    const vSel  = (selH?.value || "").trim().toUpperCase();
    if (vSel === "OTRO") {
      muniHecho = String(otroH?.value || "").trim();
    } else {
      muniHecho = String(vSel || "").trim();
    }
  }catch(_e){}
  if (!muniHecho) {
    try{
      const lh = String(jsonOut["Lugar del hecho"] || "").trim();
      const p  = lh.lastIndexOf(",");
      if (p !== -1) muniHecho = lh.slice(p+1).trim();
    }catch(_e){}
  }
  jsonOut["municipio-hecho"] = _capMuni(muniHecho);

  
  let muniDet = "";
  try{
    const selD = document.getElementById('munDetSel');
    const otroD = document.getElementById('munDetOtro');
    const vSel  = (selD?.value || "").trim().toUpperCase();
    if (vSel === "OTRO") {
      muniDet = String(otroD?.value || "").trim();
    } else {
      muniDet = String(vSel || "").trim();
    }
  }catch(_e){}
  if (!muniDet) {
    try{
      const ld = String(jsonOut["Lugar de la detenci√≥n"] || "").trim();
      const p  = ld.lastIndexOf(",");
      if (p !== -1) muniDet = ld.slice(p+1).trim();
    }catch(_e){}
  }
  jsonOut["municipio-detencion"] = _capMuni(muniDet);
})();;

        const fileName = `${sanitizeForFilename(data["Nombre"]||"")} ${sanitizeForFilename(data["APELLIDOS"]||"")} ${fechaStr}.json`.trim() || "resumen.json";

        // Coordenadas integradas desde Compapol; no se inyectan aqu√≠.
        await saveBlobJson(JSON.stringify(jsonOut, null, 2), fileName);
        msg.innerText = "‚úÖ JSON generado y descargado";
        try{
          const payload = buildRoaPayloadFromRegistro(data);
          sessionStorage.setItem('ROA_PAYLOAD', JSON.stringify(payload));
          const goBtn = document.getElementById('goRoaBtn');
          if(goBtn){ goBtn.style.display='inline-block'; goBtn.onclick = ()=>{ location.href = RUTA_ROA; }; }
        }catch(_e){}
      } catch(err){
        console.error(err);
        msg.innerText = "‚ùå " + (err?.message || err);
      }
    }

    function importarJSON(){
      const input = document.getElementById("fileInputJSON");
      input.value = null;
      input.click();
      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try{
          const text = await file.text();
          const obj = JSON.parse(text);
          window.lastImportedObj = obj;

          
          const map = new Map(Object.entries(obj).map(([k,v])=>[String(k).trim().toUpperCase(), v]));
          const get = (label) => map.get(String(label).toUpperCase()) ?? "";

          const normalizeHour = (v) => {
            const s = String(v||"").trim();
            const m = s.match(/^(\d{1,2})[:hH\.](\d{2})/);
            if (m) { const hh = m[1].padStart(2,'0'); return `${hh}:${m[2]}`; }
            return "";
          };

          
          (function(){
            
            let raw = get("Delito");
            if (!raw && ("Delito" in obj)) raw = obj["Delito"]; 
            if (!raw) raw = obj["DELITOS"] || obj["Delitos"] || obj["delitos"]; 

            let lista = [];
            if (Array.isArray(raw)) {
              lista = raw.map(v => String(v||'').trim()).filter(Boolean);
            } else if (typeof raw === 'string') {
              lista = raw ? raw.split(/\s*,\s*|\s+y\s+/i).map(v=>v.trim()).filter(Boolean) : [];
            }

            if (typeof delitosElegidos === 'undefined') { window.delitosElegidos = []; }
            
            try { delitosElegidos.splice(0, delitosElegidos.length, ...lista); } catch(_) { window.delitosElegidos = lista.slice(); }
            try { if (typeof renderDelitos === 'function') renderDelitos(); } catch(_) {}
          })();

          
          const setByName = (nameAttr, value) => {
            const el = document.querySelector(`[name="${nameAttr}"]`);
            if (!el) return;
            el.value = value ?? "";
            el.dispatchEvent(new Event("change"));
          };
          setByName("Nombre", get("Nombre"));
          setByName("APELLIDOS", get("Apellidos"));
          setByName("NACIONALIDAD", get("Nacionalidad"));
          setByName("FECHA DE NACIMIENTO", get("Fecha de nacimiento"));
          setByName("LUGAR DE NACIMIENTO", get("Lugar de nacimiento"));
          setByName("C.P. AGENTES", get("C.P. Agentes"));
          setByName("DILIGENCIAS", get("Diligencias"));
          setByName("INSTRUCTOR", get("Instructor"));
          setByName("BREVE RESUMEN DE LOS HECHOS", get("Breve resumen de los hechos"));
          setByName("INDICIOS POR LOS QUE SE DETIENE", get("Indicios por los que se detiene"));
          setByName("Indicativo", get("Indicativo"));
          setByName("FECHA_GENERACION", get("Fecha de generaci√≥n"));
          
          setByName("HORA DEL HECHO", normalizeHour(get("Hora del hecho")));
          setByName("HORA DE LA DETENCI√ìN", normalizeHour(get("Hora de la detenci√≥n")));

          
          const callSet = (name, val) => { try { setSelectWithInput(name, val); } catch(_) {} };
          callSet("DOMICILIO_OPCION", get("Domicilio"));
          callSet("TEL√âFONO_OPCION", get("Tel√©fono"));
          callSet("NOMBRE_PADRES_OPCION", get("Nombre de los Padres"));
          callSet("ABOGADO_OPCION", get("Abogado"));
          callSet("COMUNICARSE CON_OPCION", get("Comunicarse con"));
          callSet("INFORMAR DE DETENCION_OPCION", get("Informar de detenci√≥n"));
          callSet("INTERPRETE_OPCION", get("Int√©rprete"));
          callSet("SEXO_OPCION", get("Sexo"));
          callSet("TIPO DOCUMENTO_OPCION", get("Tipo de documento"));

          (function(){
            const tipoVal = String(get("Tipo de documento") || "").toUpperCase();
            const tipoSel = document.getElementById("tipoDocumento");
            if (tipoSel && (tipoVal === "INDOCUMENTADO" || tipoVal === "INDOCUMENTADA")) {
              tipoSel.value = tipoVal;
              tipoSel.dispatchEvent(new Event("change"));
            }
          })();

          const tipoSel = document.querySelector('[name="TIPO DOCUMENTO_OPCION"]');
          const tipoVal = (tipoSel && tipoSel.value) ? String(tipoSel.value).toUpperCase() : "";
          const num = (tipoVal === "INDOCUMENTADO/A") ? "" : (get("N¬∫ Documento")||"");
          setByName("N¬∫DOCUMENTO", num);

          
          callSet("MEDICO", get("M√©dico"));
          callSet("CONSULADO", get("Consulado"));

          
          (function rehidratarLugares_likeDomicilio(){
            const T = s => String(s||'').trim();
            const UP = s => T(s).toUpperCase();
            const splitLugar = (s)=>{
              s = T(s); if(!s) return {dir:'', muni:''};
              const p = s.lastIndexOf(',');
              return (p<0) ? {dir:s, muni:''} : {dir:T(s.slice(0,p)), muni:T(s.slice(p+1))};
            };
            
            function chain3(a,b,c){
              try{ a(); }catch(_){}
              requestAnimationFrame(()=>{
                queueMicrotask(()=>{
                  try{ b(); }catch(_){}
                  requestAnimationFrame(()=>{
                    queueMicrotask(()=>{ try{ c(); }catch(_){ } });
                  });
                });
              });
            }
            function rehidratar(kind){
              const isHecho = (kind==='hecho');
              const ids = isHecho
                ? { sel:'munHechoSel', via:'viaHecho', resto:'restoHecho', otro:'munHechoOtro' }
                : { sel:'munDetSel',  via:'viaDet',   resto:'restoDet',   otro:'munDetOtro'  };
              
              const L   = isHecho ? (obj["Lugar del hecho"]||obj["LUGAR DEL HECHO"]||"") : (obj["Lugar de la detenci√≥n"]||obj["LUGAR DE LA DETENCI√ìN"]||obj["LUGAR DE LA DETENCION"]||"");
              const via = isHecho ? (obj["via-hecho"]||"") : (obj["via-detencion"]||"");
              const res = isHecho ? (obj["restodireccion-hecho"]||"") : (obj["restodireccion-detencion"]||"");
              const mun = isHecho ? (obj["municipio-hecho"]||"") : (obj["municipio-detencion"]||"");
              const {dir:dirFromL, muni:munFromL} = splitLugar(L);
              const VIA   = T(via || dirFromL);
              const RESTO = T(res);
              const MUNI  = T(mun || munFromL);
              
              chain3(
                ()=>{
                  const sel  = document.getElementById(ids.sel);
                  const otro = document.getElementById(ids.otro);
                  if(!sel) return;
                  const MU = UP(MUNI);
                  if (MU === 'ADEJE' || MU === 'ARONA'){
                    sel.value = MU;
                    if (otro){ otro.value=''; otro.style.display='none'; }
                  } else if (MU){
                    sel.value = 'OTRO';
                    if (otro){ otro.value = MUNI; otro.style.display='block'; otro.dispatchEvent(new Event('input')); }
                  } else {
                    sel.value = '';
                    if (otro){ otro.value=''; otro.style.display='none'; }
                  }
                  sel.dispatchEvent(new Event('input'));
                  sel.dispatchEvent(new Event('change'));
                },
                
                ()=>{
                  const viaEl = document.getElementById(ids.via);
                  if (viaEl){
                    viaEl.style.display = 'block';
                    viaEl.value = VIA;
                    viaEl.dispatchEvent(new Event('input'));
                    viaEl.dispatchEvent(new Event('change'));
                    try{ viaEl.focus(); }catch(_){}
                  }
                },
                
                ()=>{
                  const viaEl   = document.getElementById(ids.via);
                  const restoEl = document.getElementById(ids.resto);
                  if (restoEl){
                    const show = (T(viaEl?.value)||T(RESTO)) ? true : false;
                    restoEl.style.display = show ? 'block' : 'none';
                    restoEl.value = RESTO;
                    restoEl.dispatchEvent(new Event('input'));
                    restoEl.dispatchEvent(new Event('change'));
                    try{ restoEl.blur(); }catch(_){}
                  }
                }
              );
            }
            try{ rehidratar('hecho'); }catch(_){}
            try{ rehidratar('det'); }catch(_){}
          })();

          
          const panel = document.getElementById("message");
          if (panel){
            panel.innerText = "‚úÖ JSON importado y formulario rellenado";
            setTimeout(()=>{ if (panel.innerText === "‚úÖ JSON importado y formulario rellenado") panel.innerText=""; }, 3000);
          }
        }catch(err){
          console.error(err);
          document.getElementById("message").innerText = "‚ùå Error al importar JSON: " + (err?.message || err);
        }
      };
    }
  </script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const hoy = new Date();
    const dia = String(hoy.getDate()).padStart(2, '0');
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const anio = hoy.getFullYear();
    const fecha = `${dia}/${mes}/${anio}`;

    const inputFecha = document.getElementById("fechaGeneracion");
    if (inputFecha && !inputFecha.value) {
      inputFecha.value = fecha;
    }
  });
  </script>
<div id="marca-registro">
    103<br/>
    JBN<br/>
    486<br/>
    TFS
  </div>
<script>

(function(){
  function norm(s){
    return String(s||"")
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .toUpperCase();
  }
  function contieneMunicipio(v){
    return /\b(ARONA|ADEJE)\b/.test(norm(v));
  }
  function avisar(input){
    const v = input.value;
    if (!v) return;
    if (contieneMunicipio(v)) return;
    const panel = document.getElementById('message');
    if (panel){
      panel.textContent = `‚ÑπÔ∏è Recuerda indicar ARONA o ADEJE en "${input.name}" si procede.`;
      panel.style.color = '#ffcc66';
      setTimeout(()=>{ if(panel.textContent.startsWith('‚ÑπÔ∏è Recuerda')) panel.textContent=''; }, 4000);
    }
    const prev = input.style.outline;
    input.style.outline = '2px solid orange';
    setTimeout(()=>{ input.style.outline = prev || ''; }, 2000);
  }
  function bind(){
    const hecho = document.querySelector('[name="LUGAR DEL HECHO"]');
    const det   = document.querySelector('[name="LUGAR DE LA DETENCI√ìN"]');
    if (hecho) hecho.addEventListener('blur', ()=>avisar(hecho), { passive:true });
    if (det)   det.addEventListener('blur', ()=>avisar(det),   { passive:true });
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', bind);
  else bind();
})();
  </script>
<script>

(function(){
  const panel = document.getElementById('message');
  if (!panel) return;
  let timer = null;
  function scheduleClear(){
    if (timer) { clearTimeout(timer); timer = null; }
    const txt = (panel.textContent||'').trim();
    if (!txt) return;
    timer = setTimeout(()=>{ panel.textContent = ''; }, 3000);
  }
  const obs = new MutationObserver(scheduleClear);
  obs.observe(panel, { childList:true, characterData:true, subtree:true });
  scheduleClear();
})();
  </script>
<script>

(function(){
  const inp = document.querySelector('[name="DILIGENCIAS"]');
  if (!inp) return;
  function yy(){
    const f = document.getElementById('fechaGeneracion')?.value || '';
    const m = f.match(/(\d{4})$/);
    const year = m ? Number(m[1]) : new Date().getFullYear();
    return String(year % 100).padStart(2,'0');
  }
  function normalizar(){
    let v = (inp.value||'').trim();
    if (!v) return;
    v = v.replace(/\s+/g,'');
    const m = v.match(/^(\d{1,5})(?:\/(\d{2}))?$/);
    if (!m){
      alert('Formato de Diligencias inv√°lido. Usa: 1‚Äì5 d√≠gitos + "/" + dos d√≠gitos. Ej: 2345/'+yy());
      setTimeout(()=>inp.focus(), 0);
      return;
    }
    const num = m[1];
    const suf = m[2];
    // Si faltan los dos d√≠gitos, autocompletar con el a√±o (yy) por defecto.
    inp.value = num + '/' + (suf || yy());
  }
  inp.addEventListener('blur', normalizar, { passive:true });
})();
  </script>
<script>

(function () {
  const U = s => String(s||'').trim();
  const H = v => { const m = U(v).match(/^(\d{1,2})[:hH\.](\d{2})/); return m ? `${m[1].padStart(2,'0')}:${m[2]}` : ""; };
  const D = s => { s = U(s); if(!s) return ''; let m = s.match(/^([0-3]?\d)[\/\-]([0-1]?\d)[\/\-](\d{4})$/); if(m) return `${m[3]}-${m[2].padStart(2,'0')}-${m[1].padStart(2,'0')}`; m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/); if(m) return s; m = s.match(/^(\d{4})[\/](\d{1,2})[\/](\d{1,2})$/); if(m) return `${m[1]}-${m[2].padStart(2,'0')}-${m[3].padStart(2,'0')}`; return ''; };
  const PL = s => { s=U(s); if(!s) return {via:'',muni:''}; const p=s.lastIndexOf(','); return p<0?{via:s,muni:''}:{via:s.slice(0,p).trim(), muni:s.slice(p+1).trim()}; };
  const SSI = (n,v)=>{ try{ setSelectWithInput(n,v); }catch(_){} };
  const SB = (n,v)=>{ const el=document.querySelector(`[name="${n}"]`); if(el){ el.value=v??''; el.dispatchEvent(new Event('change')); } };
  const ESV = (sel,val)=>{
    if(!sel){return}
    const s=U(val); if(!s){ sel.value=''; sel.dispatchEvent(new Event('change')); return; }
    let o=[...sel.options].find(x=>x.value===s)||[...sel.options].find(x=>x.value.toUpperCase()===s.toUpperCase());
    if(!o){ o=document.createElement('option'); o.value=s; o.textContent=s; sel.appendChild(o); }
    sel.value=o.value; sel.dispatchEvent(new Event('change'));
  };
  window.importarJSON = function(){
    const input = document.getElementById("fileInputJSON");
    input.value = null; input.click();
    input.onchange = async (e)=>{
      const f = e.target.files && e.target.files[0]; if(!f) return;
      try{
        const obj = JSON.parse(await f.text());
        const M = new Map(Object.entries(obj).map(([k,v])=>[String(k).trim().toUpperCase(), v]));
        const G = k => M.get(String(k).toUpperCase()) ?? "";

        
        (function(){
          let raw = G("Delito");
          if (!raw && ("Delito" in obj)) raw = obj["Delito"];
          if (!raw) raw = obj["DELITOS"] || obj["Delitos"] || obj["delitos"];
          let lista = [];
          if (Array.isArray(raw)) lista = raw.map(v => String(v||'').trim()).filter(Boolean);
          else if (typeof raw === 'string') lista = raw ? raw.split(/\s*,\s*|\s+y\s+/i).map(v=>v.trim()).filter(Boolean) : [];
          if (typeof delitosElegidos === 'undefined') { window.delitosElegidos = []; }
          try { delitosElegidos.splice(0, delitosElegidos.length, ...lista); } catch(_) { window.delitosElegidos = lista.slice(); }
          try { if (typeof renderDelitos === 'function') renderDelitos(); } catch(_) {}
        })();

        
        SB("Nombre", G("Nombre"));
        SB("APELLIDOS", G("Apellidos"));
        SB("NACIONALIDAD", G("Nacionalidad"));
        SB("FECHA DE NACIMIENTO", D(G("Fecha de nacimiento") || G("FECHA DE NACIMIENTO")));
        SB("LUGAR DE NACIMIENTO", G("Lugar de nacimiento"));
        SB("C.P. AGENTES", G("C.P. Agentes"));
        SB("DILIGENCIAS", G("Diligencias"));
        SB("INSTRUCTOR", G("Instructor"));
        SB("LUGAR DEL HECHO", G("Lugar del hecho"));
        SB("LUGAR DE LA DETENCI√ìN", G("Lugar de la detenci√≥n"));
        SB("BREVE RESUMEN DE LOS HECHOS", G("Breve resumen de los hechos"));
        SB("INDICIOS POR LOS QUE SE DETIENE", G("Indicios por los que se detiene"));
        SB("Indicativo", G("Indicativo"));
        SB("FECHA_GENERACION", G("Fecha de generaci√≥n"));
        SB("HORA DEL HECHO", H(G("Hora del hecho")));
        SB("HORA DE LA DETENCI√ìN", H(G("Hora de la detenci√≥n")));

        
        SSI("DOMICILIO_OPCION", G("Domicilio"));
        SSI("TEL√âFONO_OPCION", G("Tel√©fono"));
        SSI("NOMBRE_PADRES_OPCION", G("Nombre de los Padres"));
        SSI("ABOGADO_OPCION", G("Abogado"));
        SSI("COMUNICARSE CON_OPCION", G("Comunicarse con"));
        SSI("INFORMAR DE DETENCION_OPCION", G("Informar de detenci√≥n"));
        SSI("INTERPRETE_OPCION", G("Int√©rprete"));
        SSI("SEXO_OPCION", G("Sexo"));
        SSI("TIPO DOCUMENTO_OPCION", G("Tipo de documento"));
        SSI("MEDICO", G("M√©dico"));
        SSI("CONSULADO", G("Consulado"));

        
        (function(){
          const t = document.querySelector('[name="TIPO DOCUMENTO_OPCION"]');
          SB("N¬∫DOCUMENTO", (t && String(t.value).toUpperCase()==="INDOCUMENTADO/A") ? "" : (G("N¬∫ Documento")||""));
        })();

        
        (function(){
          const gv=(...ks)=>{ for(const k of ks){ if(k in obj && U(obj[k])) return U(obj[k]); const up=k.toUpperCase(),lo=k.toLowerCase(); if(up in obj && U(obj[up])) return U(obj[up]); if(lo in obj && U(obj[lo])) return U(obj[lo]); } return ''; };
          const pais = gv('pais-nacimiento','PA√çS-NACIMIENTO','PAIS-NACIMIENTO','PA√çS DE NACIMIENTO','PAIS','Pa√≠s');
          const prov = gv('provincia-nacimiento');
          const mun  = gv('municipio-nacimiento');
          const paisInp=document.getElementById('paisNacimiento'), provSel=document.getElementById('provNacimiento'), munInp=document.getElementById('munNacimiento');
          if(paisInp && pais){ paisInp.value=pais; paisInp.dispatchEvent(new Event('input')); paisInp.dispatchEvent(new Event('change')); }
          if(provSel && prov){ ESV(provSel,prov); }
          if(munInp && mun){ munInp.value=mun; munInp.dispatchEvent(new Event('input')); munInp.dispatchEvent(new Event('change')); }
          try{ if(typeof recomputeLugarNacimiento==='function') recomputeLugarNacimiento(); }catch(_){}

          const domSel=document.getElementById('domicilioOpcion'), provD=document.getElementById('provDomicilio'), munD=document.getElementById('munDomicilio'), dirD=document.getElementById('direccionDomicilio');
          const pD=gv('provincia-domicilio'), mD=gv('municipio-domicilio'), dD=gv('direccion-domicilio','Domicilio','DOMICILIO');
          if((pD||mD||dD) && domSel && domSel.value!=='APORTA'){ domSel.value='APORTA'; domSel.dispatchEvent(new Event('change')); }
          if(provD && pD){ ESV(provD,pD); }
          if(munD && mD){ munD.value=mD; munD.dispatchEvent(new Event('input')); munD.dispatchEvent(new Event('change')); }
          if(dirD && dD){ dirD.value=dD; dirD.dispatchEvent(new Event('input')); }
        })();

        
        (function(){
          const Tt = s => String(s||'').trim();
          const Up = s => Tt(s).toUpperCase();
          const splitLugar = (s)=>{
            s = Tt(s); if(!s) return {dir:'', muni:''};
            const p = s.lastIndexOf(',');
            return (p<0) ? {dir:s, muni:''} : {dir:Tt(s.slice(0,p)), muni:Tt(s.slice(p+1))};
          };
          function setMunicipio(selId, otroId, muniVal){
            const sel = document.getElementById(selId);
            const otro = document.getElementById(otroId);
            if(!sel) return;
            const MU = Up(muniVal);
            if (MU === 'ADEJE' || MU === 'ARONA'){
              sel.value = MU;
              if (otro){ otro.style.display = 'none'; otro.value = ''; }
            } else if (MU){
              sel.value = 'OTRO';
              if (otro){ otro.style.display = 'block'; otro.value = muniVal; }
            } else {
              sel.value = '';
              if (otro){ otro.style.display = 'none'; otro.value = ''; }
            }
            
          }
          function setViaResto(viaId, restoId, viaVal, restoVal){
            const viaEl = document.getElementById(viaId);
            const resEl = document.getElementById(restoId);
            if(viaEl){
              viaEl.style.display = 'block';
              viaEl.value = Tt(viaVal);
            }
            if(resEl){
              resEl.style.display = 'block';
              resEl.value = Tt(restoVal);
            }
          }
          
          (function(){
            const L   = obj["Lugar del hecho"] || obj["LUGAR DEL HECHO"] || "";
            const via = obj["via-hecho"] || "";
            const res = obj["restodireccion-hecho"] || "";
            const mun = obj["municipio-hecho"] || "";
            const fromL = splitLugar(L);
            setMunicipio('munHechoSel','munHechoOtro', mun || fromL.muni);
            setViaResto('viaHecho','restoHecho', via || fromL.dir, res);
          })();
          
          (function(){
            const L   = obj["Lugar de la detenci√≥n"] || obj["LUGAR DE LA DETENCI√ìN"] || obj["LUGAR DE LA DETENCION"] || "";
            const via = obj["via-detencion"] || "";
            const res = obj["restodireccion-detencion"] || "";
            const mun = obj["municipio-detencion"] || "";
            const fromL = splitLugar(L);
            setMunicipio('munDetSel','munDetOtro', mun || fromL.muni);
            setViaResto('viaDet','restoDet', via || fromL.dir, res);
          })();
        })();

        const msg=document.getElementById("message"); if(msg) msg.innerText="‚úÖ JSON importado y formulario rellenado";
      }catch(err){
        console.error(err);
        const msg=document.getElementById("message"); if(msg) msg.innerText="‚ùå Error al importar JSON: "+(err?.message||err);
      }
    };
  };
})();
</script>
<script id="glass-autowrap">
(function(){
  function shouldWrap(el){
    if(!el) return false;
    if(el.disabled || el.readOnly) return false;
    if(el.tagName === 'INPUT'){
      const t = (el.getAttribute('type')||'text').toLowerCase();
      if(['hidden','file'].includes(t)) return false;
    }
    return true;
  }
  function wrap(el){
    if(el.closest('.glass-wrap')) return; 
    const wrap = document.createElement('div');
    wrap.className = 'glass-wrap';
    el.classList.add('glass-field');
    el.parentNode.insertBefore(wrap, el);
    wrap.appendChild(el);
  }
  function apply(scope){
    const nodes = scope.querySelectorAll('select, input, textarea');
    nodes.forEach(n => { if(shouldWrap(n)) wrap(n); });
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){ apply(document.body); }, { once: true });
  } else {
    apply(document.body);
  }
})();
</script>
	<script>
// üëâ Funci√≥n √∫nica para validar contra un datalist
function alertaListaById(inputId, datalistId, mensaje){
  const inp = document.getElementById(inputId);
  if (!inp) return;

  inp.addEventListener('blur', () => {
    const v = (inp.value || "").trim().toUpperCase();
    if (!v) return; // no molestar si est√° vac√≠o

    const opciones = [...document.querySelectorAll(`#${datalistId} option`)]
      .map(o => (o.value || "").trim().toUpperCase());

    if (!opciones.includes(v)){
      alert("‚ö†Ô∏è " + mensaje);
    }
  });
}

// üëâ Activar todas las validaciones simples al cargar
document.addEventListener('DOMContentLoaded', () => {
  // Nacionalidad
  alertaListaById(
    "nacionalidadInput",
    "listaNacionalidad",
    "La nacionalidad debe coincidir con un pa√≠s del listado."
  );

  // Pa√≠s de nacimiento
  alertaListaById(
    "paisNacimiento",
    "listaPaisNacimiento",
    "El pa√≠s de nacimiento debe coincidir con un pa√≠s del listado."
  );

  // Municipio nacimiento
  alertaListaById(
    "munNacimiento",
    "listaMunNacimiento",
    "El municipio de nacimiento debe coincidir con el listado."
  );

  // Municipio domicilio
  alertaListaById(
    "munDomicilio",
    "listaMunDomicilio",
    "El municipio del domicilio debe coincidir con el listado."
  );

  // Calle HECHO
  alertaListaById(
    "viaHecho",
    "listaViaHecho",
    "La v√≠a del hecho no coincide con ninguna v√≠a del callejero."
  );

  // Calle DETENCI√ìN
  alertaListaById(
    "viaDet",
    "listaViaDet",
    "La v√≠a de la detenci√≥n no coincide con ninguna v√≠a del callejero."
  );
});
</script>
</body>
</html>
































